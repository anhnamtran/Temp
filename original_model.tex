\newcommand{\code}[1]{\texttt{#1}}

\subsection{The Problem}
There are special heuristics that Cozy follows to prevent unwanted behaviours,
one of which prevents Cozy from storing integer arithmetic as state variables.
Once this heuristic is removed, Cozy will start producing unwanted state
variables. Specifically, when the heuristic is removed and Cozy is provided with
this specification:

\begin{center}
\begin{lstlisting}
    Incrementer:
        state x : Int
        query get()
            x
        op increment()
            x = x + 1;
\end{lstlisting}
\end{center}

It will continuously store each subsequent increment of \code{x} as state
variables. As Cozy runs for longer and longer, the stored states will grow
continuously, adding on \code{(x + 1)}, \code{((x + 1) + 1)},
\code{(((x + 1) + 1) +1)}, and so forth.

When the heuristic is not in place, the cost model will tell Cozy that storing
each increment of \code{x} as a state is better than just storing \code{x}
itself. To prevent this behaviour and also remove the necessity of the
heuristic, we introduced freebies to the cost model. Freebies are state
variables that will have no cost. With them in place, Cozy would choose to store
just \code{x} instead of its increments as states.

\subsection{Overview}
The original model uses prioritized ordering between values of expressions. The
ordering tells the cost model which value it cares about: most to least. From
first to last, the cost model will compare the asymptotic runtimes, the max
storage sizes, the true runtimes, and the sizes of two expressions. The
prioritized ordering ensures that values lower in the priority list will only be
calculated to break ties from the more important ones.

Freebies are stored in a list that will be used to calculate the storage size of
expressions, which will affect their max storage sizes.

\subsection{Challenges}
The challenge is how to choose which state variables to become freebies.
One option is to just use state variables that are also hints taken from values
of the concretization functions. However, since the hints contain states
generated by every query, they introduce a problem: Cozy might change its mind
on a query and decide to remove it, in which case the states associated with it
would be removed as well. This will leave states that Cozy does not use but the
cost model still considers to be free. This may result in Cozy generating poor
implementations that was not supposed to be there in the first place.

So instead of using hints, the freebies are chosen from a list of state
variables that are maintained by the query currently being improved. By choosing
the freebies this way, we make sure that the state variable is only free for
subqueries derived from the current query and not for any other queries.
